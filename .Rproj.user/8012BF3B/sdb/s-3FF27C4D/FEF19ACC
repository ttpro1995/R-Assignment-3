{
    "contents" : "submit <- local({\n        checkResult <- function(r, name = c(\"best\", \"rankhospital\", \"rankall\")) {\n                name <- match.arg(name)\n                if(name == \"best\" || name == \"rankhospital\") {\n                        if(length(r) == 1L && is.na(r))\n                                return(r)\n                        if(!is.character(r))\n                                stop(sprintf(\"'%s' did not return a character vector\",\n                                             name))\n                        if(!length(r))\n                                stop(sprintf(\"'%s' returned character vector of length 0\", name))\n                        if(length(r) > 1)\n                                stop(sprintf(\"'%s' returned a character vector of length > 1\", name))\n                }\n                else if(name == \"rankall\") {\n                        if(!is.data.frame(r))\n                                stop(sprintf(\"'%s' did not return a data frame\", name))\n                        if(ncol(r) != 2L)\n                                stop(sprintf(\"'%s' should return data frame with exactly 2 columns\", name))\n                        if(!all(names(r) %in% c(\"hospital\", \"state\")))\n                                stop(\"column names of data frame should be 'hospital' and 'state'\")\n                }\n                r\n        }\n        getOutput <- function(sid) {\n                ## JUST FOR TESTING\n                ## sid <- sub(\"-dev\", \"\", sid, fixed = TRUE)\n                if(sid == \"best-1\") {\n                        source(\"best.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"best(\\\"SC\\\", \\\"heart attack\\\")\\n\")\n                        r <- best(\"SC\", \"heart attack\")\n                        checkResult(r, \"best\")\n                }\n                else if(sid == \"best-2\") {\n                        source(\"best.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"best(\\\"NY\\\", \\\"pneumonia\\\")\\n\")\n                        r <- best(\"NY\", \"pneumonia\")\n                        checkResult(r, \"best\")\n                }\n                else if(sid == \"best-3\") {\n                        source(\"best.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"best(\\\"NN\\\", \\\"pneumonia\\\")\\n\")\n                        r <- tryCatch(best(\"NN\", \"pneumonia\"), error = function(e) e)\n                        if(!inherits(r, \"error\"))\n                                stop(\"'best' should throw an error via the 'stop' function in this case\")\n                        tolower(conditionMessage(r))\n                }\n                else if(sid == \"rankhospital-1\") {\n                        source(\"rankhospital.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankhospital(\\\"NC\\\", \\\"heart attack\\\", \\\"worst\\\")\\n\")\n                        r <- rankhospital(\"NC\", \"heart attack\", \"worst\")\n                        checkResult(r, \"rankhospital\")\n                }\n                else if(sid == \"rankhospital-2\") {\n                        source(\"rankhospital.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankhospital(\\\"WA\\\", \\\"heart attack\\\", 7)\\n\")\n                        r <- rankhospital(\"WA\", \"heart attack\", 7)\n                        checkResult(r, \"rankhospital\")\n                }\n                else if(sid == \"rankhospital-3\") {\n                        source(\"rankhospital.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankhospital(\\\"WA\\\", \\\"pneumonia\\\", 1000)\\n\")\n                        rankhospital(\"WA\", \"pneumonia\", 1000)\n                }\n                else if(sid == \"rankhospital-4\") {\n                        source(\"rankhospital.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankhospital(\\\"NY\\\", \\\"heart attak\\\", 7)\\n\")\n                        r <- tryCatch({\n                                rankhospital(\"NY\", \"heart attak\", 7)\n                        }, error = function(e) {\n                                e\n                        })\n                        if(!inherits(r, \"error\"))\n                                stop(\"'rankhospital' should throw an error via 'stop' in this case\")\n                        tolower(conditionMessage(r))\n                }\n                else if(sid == \"rankall-1\") {\n                        source(\"rankall.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankall(\\\"heart attack\\\", 4)\\n\")\n                        r <- rankall(\"heart attack\", 4)\n                        r <- checkResult(r, \"rankall\")\n                        as.character(subset(r, state == \"HI\")$hospital)\n                }\n                else if(sid == \"rankall-2\") {\n                        source(\"rankall.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankall(\\\"pneumonia\\\", \\\"worst\\\")\\n\")\n                        r <- rankall(\"pneumonia\", \"worst\")\n                        r <- checkResult(r, \"rankall\")\n                        as.character(subset(r, state == \"NJ\")$hospital)\n                }\n                else if(sid == \"rankall-3\") {\n                        source(\"rankall.R\", local = TRUE)\n                        cat(\"Running test:\\n\")\n                        cat(\"rankall(\\\"heart failure\\\", 10)\\n\")\n                        r <- rankall(\"heart failure\", 10)\n                        r <- checkResult(r, \"rankall\")\n                        as.character(subset(r, state == \"NV\")$hospital)\n                }\n                else {\n                        stop(\"invalid part number\")\n                }\n        }\n        partPrompt <- function() {\n                partlist <- list(\"best-1\" = \"'best' part 1\",\n                                 \"best-2\" = \"'best' part 2\",\n                                 \"best-3\" = \"'best' part 3\",\n                                 \"rankhospital-1\" = \"'rankhospital' part 1\",\n                                 \"rankhospital-2\" = \"'rankhospital' part 2\",\n                                 \"rankhospital-3\" = \"'rankhospital' part 3\",\n                                 \"rankhospital-4\" = \"'rankhospital' part 4\",\n                                 \"rankall-1\" = \"'rankall' part 1\",\n                                 \"rankall-2\" = \"'rankall' part 2\",\n                                 \"rankall-3\" = \"'rankall' part 3\"\n                                 )\n                pretty_out(\"Which part are you submitting?\")\n                part <- select.list(partlist, graphics=FALSE)\n                names(part)\n        }\n        getChallenge <- function(email, challenge.url) {\n                params <- list(email_address = email, response_encoding = \"delim\")\n                result <- getForm(challenge.url, .params = params)\n                s <- strsplit(result, \"|\", fixed = TRUE)[[1]]\n                list(ch.key = s[5], state = s[7])\n        }\n        challengeResponse <- function(password, ch.key) {\n                x <- paste(ch.key, password, sep = \"\")\n                digest(x, algo = \"sha1\", serialize = FALSE)\n        }\n        submitSolution <- function(email, ch.resp, sid, output, signature, submit.url,\n                                   src = \"\", http.version = NULL) {\n                output <- as.character(base64(output))\n                src <- as.character(base64(src))\n                params <- list(assignment_part_sid = sid,\n                               email_address = email,\n                               submission = output,\n                               submission_aux = src,\n                               challenge_response = ch.resp,\n                               state = signature)\n                params <- lapply(params, URLencode)\n                result <- postForm(submit.url, .params = params)\n                s <- strsplit(result, \"\\\\r\\\\n\")[[1]]\n                tail(s, 1)\n        }\n        get_courseid <- function() {\n                pretty_out(\"The first item I need is your Course ID. For example, if the\",\n                           \"homepage for your Coursera course was\",\n                           \"'https://class.coursera.org/rprog-001',\",\n                           \"then your course ID would be 'rprog-001' (without the quotes).\", skip_after=TRUE)\n                repeat {\n                        courseid <- readline(\"Course ID: \")\n                                        # Remove quotes if there are any\n                        courseid <- gsub(\"\\'|\\\"\", \"\", courseid)\n                                        # Set up test cases\n                        is_url <- str_detect(courseid, \"www[.]|http:|https:\")\n                        is_numbers <- str_detect(courseid, \"^[0-9]+$\")\n                        is_example <- str_detect(courseid, fixed(\"rprog-001\"))\n                        \n                                        # Check if courseid is none of the bad things\n                        if(!any(is_url, is_numbers, is_example)){\n                                break\n                                        # courseid is one of the bad things\n                        } else {\n                                        # Check if courseid is a url\n                                if(is_url) {\n                                        pretty_out(\"It looks like you entered a web address, which is not what I'm\",\n                                                   \"looking for.\")\n                                }\n                                        # Check if courseid is all numbers\n                                if(is_numbers) {\n                                        pretty_out(\"It looks like you entered a numeric ID, which is not what I'm\",\n                                                   \"looking for.\")\n                                }\n                                        # Check if the user stole the example courseid\n                                if(is_example) {\n                                        pretty_out(\"It looks like you entered the Course ID that I used as an\",\n                                                   \"example, which is not what I'm looking for.\")\n                                }\n                        }\n                        pretty_out(\"Instead, I need your Course ID, which is the last\",\n                                   \"part of the web address for your Coursera course.\",\n                                   \"For example, if the homepage for your Coursera course was\",\n                                   \"'https://class.coursera.org/rprog-001',\",\n                                   \"then your course ID would be 'rprog-001' (without the quotes).\",\n                                   skip_after=TRUE)\n                }\n                courseid\n        }\n        pretty_out <- function(..., skip_before=TRUE, skip_after=FALSE) {\n                wrapped <- strwrap(str_c(..., sep = \" \"),\n                                   width = getOption(\"width\") - 2)\n                mes <- str_c(\"| \", wrapped, collapse = \"\\n\")\n                if(skip_before) mes <- paste0(\"\\n\", mes)\n                if(skip_after) mes <- paste0(mes, \"\\n\")\n                message(mes)\n        }\n        checkPkgs <- function() {\n                pkg.inst <- installed.packages()\n                pkgs <- c(\"RCurl\", \"digest\", \"stringr\")\n                have.pkg <- pkgs %in% rownames(pkg.inst)\n                \n                if(any(!have.pkg)) {\n                        message(\"\\nSome packages need to be installed.\\n\")\n                        r <- readline(\"Install necessary packages [y/n]? \")\n                        if(tolower(r) == \"y\") {\n                                need <- pkgs[!have.pkg]\n                                message(\"\\nInstalling packages \",\n                                        paste(need, collapse = \", \"))\n                                install.packages(need)\n                        }\n                }\n        }\n        loginPrompt <- function() {\n                courseid <- get_courseid()       \n                email <- readline(\"Submission login (email): \")\n                passwd <- readline(\"Submission  password: \")\n                r <- list(courseid = courseid, email = email, passwd = passwd)\n                assign(\".CourseraLogin\", r, globalenv())\n                invisible(r)\n        }\n        function(manual = FALSE, resetLogin = FALSE) {\n                checkPkgs()\n                suppressPackageStartupMessages(library(RCurl))\n                library(digest)\n                library(stringr)\n                readline(\"\\nPress Enter to continue...\")\n                if(!manual) {\n                        confirmed <- FALSE\n                        need2fix <- FALSE\n                        while(!confirmed) {\n                                if(exists(\".CourseraLogin\") && !resetLogin && !need2fix)\n                                        cred <- get(\".CourseraLogin\")\n                                else\n                                        cred <- loginPrompt()\n                                if(!is.list(cred) || !(names(cred) %in% c(\"email\", \"passwd\", \"courseid\")))\n                                        stop(\"problem with login/password\")\n                                \n                                courseid <- cred$courseid\n                                email <- cred$email\n                                password <- cred$passwd\n                                \n                                pretty_out(\"Is the following information correct?\",\n                                           skip_after=TRUE)\n                                message(\"Course ID: \", courseid,\n                                        \"\\nSubmission login (email): \", email, \n                                        \"\\nSubmission password: \", password)\n                                yn <- c(\"Yes, go ahead!\", \n                                        \"No, I need to change something.\")\n                                confirmed <- identical(select.list(yn, graphics=FALSE), yn[1])\n                                if(!confirmed) need2fix <- TRUE\n                        }\n                        \n                                        # Set urls based on confirmed courseid\n                        challenge.url <- paste(\"http://class.coursera.org\", courseid,\n                                               \"assignment/challenge\", sep = \"/\")\n                        submit.url <- paste(\"http://class.coursera.org\", courseid,\n                                            \"assignment/submit\", sep = \"/\")\n                }\n                ## Prompt Submission Part\n                sid <- partPrompt()\n                \n                ## Get output\n                output <- getOutput(sid)        \n                \n                if(!manual) {\n                        ## Get challenge\n                        ch <- try(getChallenge(email, challenge.url), silent=TRUE)\n                                        # Check if url is valid, i.e. challenge received\n                        ch_ok <- !is(ch, \"try-error\") && exists(\"ch.key\", ch) && !is.na(ch$ch.key)\n                        if(!ch_ok) {\n                                stop(\"Either the course ID you entered is not valid or your course site \", \n                                     \"is unreachable at this time. If you'd like to submit manually, you \", \n                                     \"can run submit(manual=TRUE).\")\n                        }\n                        \n                        ## Attempt submission with challenge\n                        ch.resp <- challengeResponse(password, ch$ch.key)\n                        results <- submitSolution(email, ch.resp, sid, output, ch$state, \n                                                  submit.url = submit.url)\n                        if(!length(results))\n                                results <- \"Incorrect!\"\n                        cat(\"Result: \", results, \"\\n\")\n                }\n                else {\n                        outfile <- paste(sid, \"output.txt\", sep = \"-\")\n                        writeLines(as.character(output), outfile)\n                        cat(sprintf(\"Please upload the file '%s' to Coursera\\n\",\n                                    outfile))\n                }\n                invisible()\n        }\n})\n",
    "created" : 1422095065604.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2624191553",
    "id" : "FEF19ACC",
    "lastKnownWriteTime" : 1422095068,
    "path" : "~/Rproject/Assignment 3/submitscript3.R",
    "project_path" : "submitscript3.R",
    "properties" : {
    },
    "source_on_save" : true,
    "type" : "r_source"
}